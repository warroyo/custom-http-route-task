# Custom Container Task for adding an HTTP route

For demo purposes this adds a container task to the `tanzu build` and `deploy` commands so that when the output is generated by the command a `httproute` si also automatically created.


## Usage

1. Create a custom `containerAppBuildPlan`. We can do this by getting the existing one and modifying it.

```bash
tanzu project use <your project>

k get containerappbuildplans  simple.tanzu.vmware.com -o yaml > custom-bp.yml
```

modify the output yaml and change the name to `custom-build-plan` 

add the following to the `runtimes["kubernetes-carvel-package"].steps` section

```yaml
  - name: add-route
    containertask:
      image: warroyo90/add-http-route-task
```

apply this back into the platform

```bash
k apply -f custom-bp.yml
```

1. set the build plan source 

```bash

tanzu build config --build-plan-source custom-build-plan
```

3. deploy or build your app and check the output for the httproute


## How it works

This uses a custom `containerTask` that implements a simple python script to copy info from the containerapp output and generate a httproute yaml file.

A containerTask is simply an additional step that is executed during the build in a custom built container. The build will pull down the container image and execute it with access to some specific build related environment vars and directories. In this case the image has a sample httproute yaml file and a python script.the script is executed on container startup and reads values from the generated containerapp and uses them to populate the httproute appropriately. It then writes out the httproute yaml into the output dir which is then used during the deploy.


# Contributing 
This is only needed for Development 

## Building the task

```bash

tanzu build -r container-image


```


